import { CopyToClipboard, Link, Table, Td, Th, Tr, Callout } from 'nextra/components'

# Webhook

SimplifyTrip uses webhooks to notify your application whenever events occur on your data. Each webhook includes an event type, endpoint, HTTP method, and JSON payload.

You can view and manage webhook events delivered to your endpoint in <a href={process.env.NEXT_PUBLIC_PARTNERS_URL + '/stats/webhooks'} className="underline" target='_blank'>Webhook statistics</a>.

<Callout>
 	To change webhook endpoint, go to <a href={process.env.NEXT_PUBLIC_PARTNERS_URL + '/developers'} className="underline text-inherit" target='_blank'>API Key management</a>, each endpoint is associated with a specific API key.
</Callout>

### General conventions

- Content-Type: `application/json`
- Authorization: use `X-Simplify-Trip-Signature` header for verification
- Retry: maximum 3 retries, 5 minutes apart
- Idempotency: use `id` with `sentDate`, `createdAt` to avoid duplicate handling, and use `type` to identify payload [Webhook list](#webhook-list)


### Setup
Provide an endpoint in your system to receive webhooks. Webhook notifications are sent via POST to the configured URL.
Configure webhook URL in API key settings. You can set one endpoint per API key or share one endpoint across multiple keys. You can use tools such as `ngrok` during testing.

### Event Handling
Correct webhook handling is critical to ensure your business logic behaves as expected.

##### Acknowledge events immediately

If your webhook endpoint performs complex logic or network calls, it may time out before SimplifyTrip receives a success response. Ideally, acknowledge event receipt first (2xx), then process business logic asynchronously.

##### Handle duplicate events

Webhook endpoints may receive the same event multiple times. Make your event handling idempotent by storing processed events and skipping duplicates. Each webhook includes a unique webhook-id to help implement idempotency. Learn more about [idempotency](https://en.wikipedia.org/wiki/Idempotence).

##### Event ordering

SimplifyTrip does not guarantee delivery order of events. Your endpoint should not assume event ordering and should handle out-of-order events safely. You can fetch missing objects through API.

### Retry

SimplifyTrip retries webhook delivery unless your endpoint returns 4xx. Since 4xx indicates an issue in your system, automatic retry is skipped. Fix your system issue, then manually resend webhook from <a href={process.env.NEXT_PUBLIC_PARTNERS_URL + '/stats/webhooks'} className="underline" target='_blank'>Webhook statistics</a>.

Maximum automatic retries: 3. Retry interval: 5 minutes.

### Security
Securing your endpoint is important to protect customer information. SimplifyTrip provides several ways to verify incoming events safely.

- **Receive events through HTTPS server**

	If your webhook endpoint uses HTTPS, SimplifyTrip verifies secure transport before sending payloads. Your server must be correctly configured with a valid TLS certificate.

- **Replay protection:**

	Check `id`, `sentDate`, and `createdAt`; accept each event once within a 24-hour window.

- **Verify events sent from SimplifyTrip**

	SimplifyTrip signs webhook events sent to your endpoint.
	A `signature` is generated for each event and sent in request header `X-Simplify-Trip-Signature`. This allows you to verify events are from SimplifyTrip, not third parties. See [Verify data with signature](/developers/signature).

## Webhook list
### eSIM order payload
Event payload after your eSIM purchase order is completed. Includes signature and order object with purchased eSIM list.
<div className="grid grid-cols-1 sm:grid-cols-2 gap-5 w-full">
	<div>
	##### Request Headers

	<div className="mt-3">
		<code>`X-Simplify-Trip-Signature` - <span className="text-[10px] text-red-500">required</span></code>

		<code className='text-red-500 text-xs ml-2'>`string`</code>

		A signature is a string used to verify data integrity between your system and SimplifyTrip. See [Verify data with signature](/developers/signature).

	</div>
	##### Request Body
	<Table rules="none" border={0} width="100%" className='border-0'>
	<tbody>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>id</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Unique identifier of this webhook
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>type</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Webhook event type `PURCHASE_ORDER_SUCCESS` | `PURCHASE_ORDER_FAIL`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>createdAt</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event creation time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>sentDate</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event sent time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>mode</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Mode: test or live `TEST_MODE` | `LIVE_MODE`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>data</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`object`</code>

				Contains order information including purchased eSIM list and identifiers...
			</Td>
		</Tr>
	</tbody>
	</Table>

	</div>
	<div>
<CH.Code>
```json BodyData
{
  "id": "6741ae7de65369e169a70758",
  "sentDate": "2024-11-23T10:29:17.887Z",
  "createdAt": "2024-11-23T10:29:17.887Z",
  "mode": "TEST_MODE",
  "type": "PURCHASE_ORDER_SUCCESS",
  "data": {
    "orderId": "7258736707",
    "trackId": "fd66829c-f768-43a7-b147-9e92d44c4e81",
	"status": "SUCCESS",
    "items": [
      {
        "subOrderId": "6741ae68e65369e169a70757",
        "subTrackId": "c6858ae7-0f40-4f44-be1a-ac656851ba92",
        "sku": "E23XY06GB08DFX",
        "quantity": 1,
		"type": "eSIM",
		"status": "SUCCESS",
        "eSims": [
          {
			"qrCodeContent": "LPA:1$SECSMSMINIAPP.EASTCOMPEACE.COM$502F97EF09144E0C9D62FD781E259916",
            "qrCodeImg": "https://files.simplifytrip.com/a11dd3c438f38f5383fa17c8ea2de3ef.png",
            "iccid": "89812003916820393515",
            "planAPN": "plus.4g",
            "smdpAddress": "SECSMSMINIAPP.EASTCOMPEACE.COM",
            "pin": "1234",
            "puk": "15095300",
            "activationCode": "502F97EF09144E0C9D62FD781E256383"
          }
        ]
      }
    ]
  }
}
```
```json Headers
{
	"X-Simplify-Trip-Signature": "6236b093f1e9ce8fee57110e5a11e8fbdcc59d57f654adb7a70522aaf26cd77a"
}
```
</CH.Code>

	</div>
</div>

### Physical SIM order payload
Event payload when physical SIM order status changes. Includes signature and order status object.
<div className="grid grid-cols-1 sm:grid-cols-2 gap-5 w-full">
	<div>
	##### Request Headers

	<div className="mt-3">
		<code>`X-Simplify-Trip-Signature` - <span className="text-[10px] text-red-500">required</span></code>

		<code className='text-red-500 text-xs ml-2'>`string`</code>

		A signature is a string used to verify data integrity between your system and SimplifyTrip. See [Verify data with signature](/developers/signature).

	</div>
	##### Request Body
	<Table rules="none" border={0} width="100%" className='border-0'>
	<tbody>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>id</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

					Unique identifier of this webhook
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>type</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Webhook event type `PURCHASE_ORDER_UPDATE`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>createdAt</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event creation time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>sentDate</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event sent time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>mode</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Mode: test or live `TEST_MODE` | `LIVE_MODE`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>data</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`object`</code>

				Contains order information, including status `NEW` | `CONFIRMED` | `DELIVERING` | `SUCCESS` | `CANCELED`

			</Td>
		</Tr>
	</tbody>
	</Table>

	</div>
	<div>
<CH.Code>
```json BodyData
{
  "id": "6741ae7de65369e169a70758",
  "sentDate": "2024-11-23T10:29:17.887Z",
  "createdAt": "2024-11-23T10:29:17.887Z",
  "mode": "TEST_MODE",
  "type": "PURCHASE_ORDER_UPDATE",
  "data": {
    "orderId": "7258736707",
    "trackId": "fd66829c-f768-43a7-b147-9e92d44c4e81",
	"status": "SUCCESS",
    "items": [
      {
        "subOrderId": "6741ae68e65369e169a70757",
        "subTrackId": "c6858ae7-0f40-4f44-be1a-ac656851ba92",
        "sku": "AS7BCUNL03DPY",
        "quantity": 3,
		"type": "SIM",
		"status": "SUCCESS"
      }
    ]
  }
}
```
```json Headers
{
	"X-Simplify-Trip-Signature": "6236b093f1e9ce8fee57110e5a11e8fbdcc59d57f654adb7a70522aaf26cd77a"
}
```
</CH.Code>

	</div>
</div>

### Return request payload
Event payload when return request status changes. Includes signature and return-status object.
<div className="grid grid-cols-1 sm:grid-cols-2 gap-5 w-full">
	<div>
	##### Request Headers

	<div className="mt-3">
		<code>`X-Simplify-Trip-Signature` - <span className="text-[10px] text-red-500">required</span></code>

		<code className='text-red-500 text-xs ml-2'>`string`</code>

		A signature is a string used to verify data integrity between your system and SimplifyTrip. See [Verify data with signature](/developers/signature).

	</div>
	##### Request Body
	<Table rules="none" border={0} width="100%" className='border-0'>
	<tbody>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>id</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

					Unique identifier of this webhook
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>type</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Webhook event type `RETURN_ORDER_UPDATE`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>createdAt</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event creation time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>sentDate</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`datetime`</code>

				Webhook event sent time
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>mode</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`string`</code>

				Mode: test or live `TEST_MODE` | `LIVE_MODE`
			</Td>
		</Tr>
		<Tr className='border-0 !bg-inherit'>
			<Td className='border-0'><code>data</code> - <span className="text-[10px] text-red-500">required</span></Td>
			<Td className='border-0'>
				<code className='text-red-500 text-xs'>`object`</code>

				Contains return request information, including status `REVIEWING` | `APPROVED` | `REJECTED`

			</Td>
		</Tr>
	</tbody>
	</Table>

	</div>
	<div>
<CH.Code>
```json BodyData
{
  "id": "6741ae7de65369e169a70758",
  "sentDate": "2024-11-23T10:29:17.887Z",
  "createdAt": "2024-11-23T10:29:17.887Z",
  "mode": "TEST_MODE",
  "type": "RETURN_ORDER_UPDATE",
  "data": {
    "id": "6741ae68e65369e169a70757",
	"createdAt": "2024-11-23T10:29:17.887Z",
    "orderId": "7258736707",
    "trackId": "fd66829c-f768-43a7-b147-9e92d44c4e81",
	"status": "REVIEWING",
	"reason": "reason",
	"returnType": "FULL",
	"refundAmount": 205000,
    "items": [
      {
        "productName": "Southeast Asia SIM (7 countries), data-only (Unlimited Data/day - 3 days)",
        "sku": "AS7BCUNL03DPY",
        "quantity": 3,
		"type": "SIM",
      }
    ]
  }
}
```
```json Headers
{
	"X-Simplify-Trip-Signature": "6236b093f1e9ce8fee57110e5a11e8fbdcc59d57f654adb7a70522aaf26cd77a"
}
```
</CH.Code>

	</div>
</div>
